---
title: "Next.jsã§ãƒ–ãƒ­ã‚°ã‚’ã¤ãã£ãŸ"
date: 2022-03-26
lastmod: 2023-10-05
description: "è‡ªä½œãƒ–ãƒ­ã‚°ã®å®Ÿè£…ã«ã¤ã„ã¦"
tags: ["tech", "web", "nextjs", "react"]
emoji: "ğŸ“"
---

ï¼ˆ2022/03/03 è¿½è¨˜ï¼‰Next.js 13 / App Routerå¯¾å¿œã‚’[ã‚„ã£ãŸ](/blog/posts/blog-next-13)

ï¼ˆ2023/10/05 è¿½è¨˜ï¼‰Astroã§[æ›¸ãç›´ã—ãŸ](/blog/posts/blog-astro-renewal)

## ã¯ã˜ã‚ã«

[https://github.com/haxibami/haxibami.net](https://github.com/haxibami/haxibami.net)

ãƒ–ãƒ­ã‚°ã‚’è‡ªä½œã—ãŸã€‚æ±ºã‚æ‰‹ã¯ä»¥ä¸‹ã®å››ã¤ã€‚

1. é©åº¦ãªè·é›¢
2. ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§
3. é«˜é€Ÿæ€§ã¨æ‹¡å¼µæ€§
4. ç„¡åºƒå‘Š

### 1. é©åº¦ãªè·é›¢

ã‚ã‚‰ã‚†ã‚‹ã‚‚ã®ãŒæœ€é©åŒ–ã•ã‚Œã¦æä¾›ã•ã‚Œã‚‹ã“ã®æ™‚ä»£ã€é…é…ã‚„èª¤é…ã®ç¢ºç‡ã¯ã¨ã¦ã‚‚ä½ã„ã€‚å¤§ããªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®buzzã‚’ã™ã™ã‚“ã§å¾ŒæŠ¼ã—ã—ã€ã‹ã‚Œã«å‘ã‘ã¦ã€ã‹ã‚Œã®ãŸã‚ã«ã€ã¨ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã«èºèµ·ã ã€‚æ›¸ãæ‰‹ã¨èª­ã¿æ‰‹ã®è·é›¢ã¯é€æ˜ã«ã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç¢ºå®Ÿã«ã€‚ã ãŒãã†ã§ã¯ãªã„å½¢å¼ã‚‚ã‹ã¤ã¦ã¯ã‚ã£ãŸã€‚ã²ã‚‡ã£ã¨ã—ãŸã‚‰èª°ã‹ã«æ‹¾ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€ã‚ã‚‹ã„ã¯Googleã®ã‚¯ãƒ­ãƒ¼ãƒ©ã«ã•ãˆæ‹¾ã‚ã‚Œãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€ãã†ã—ãŸç¢ºç‡è«–çš„ãªé›²ã®ãªã‹ã«è‡ªã‚‰ã®æ›¸ã„ãŸã‚‚ã®ã‚’æ‰“ã¡ä¸Šã’ã‚‹ã€‚ãã—ã¦ç¥ˆã‚‹ã€‚\{å¤ãè‰¯ãæ—¥ã€…|ã‚°ãƒƒãƒ‰ãƒ»ã‚ªãƒ¼ãƒ«ãƒ‰ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒ„}ã¯ç†æƒ³éƒ·ã§ã¯ãªã‹ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ãŒã€ã‚ã®èª°ã‹ã®ã‚‚ã®ã«ãªã‚‹å‰ã®ä¸–ç•Œã®ã€ãã®æ­ªãªæ‰‹è§¦ã‚Šã‚’è¦šãˆã¦ãŠããŸã‚ã®ã€å€‹äººã‚µã‚¤ãƒˆã¨ã„ã†è·é›¢æ„Ÿã€‚

### 2. ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§

å…ˆäººãŸã¡ãŒç¤ºã—ã¦ããŸã¨ãŠã‚Šã€ã“ã®æ‰‹ã®å€‹äººã‚µã‚¤ãƒˆã¯ç®¡ç†ãƒ»ç§»è¡ŒãŒå„„åŠ«ã«ãªã£ãŸæ™‚ç‚¹ã§**ã‚¨ã‚¿ã‚‹**ã€‚æ”¾ç½®ã•ã‚ŒãŸã€Œã€‡ã€‡ã®éƒ¨å±‹ã€ã€æ¶ˆãˆã¦é‚„ã‚‰ãªã„å€Ÿã‚Šãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã‚€ãªã—ãåˆ»ã‚€å…¥å®¤ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŸã¡ã‚’çœºã‚ã‚‹ãŸã³ã«ã€ã›ã‚ã¦è¨˜äº‹ãã‚‰ã„ã¯ç§»è¡Œã—ã‚„ã™ã„å½¢å¼ã§æ‰±ã„ãŸã„ã¨æ€ã†ã‚ˆã†ã«ãªã£ãŸã€‚ãã†ã„ã†ã‚ã‘ã§Markdownï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ + tsxï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ã€‚ã“ã®çµ„ã¿åˆã‚ã›ãªã‚‰ãã†ç°¡å˜ã«ã¯å»ƒã‚Œãªã„ã ã‚ã†ã—ã€ã„ã¤ã‹åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ãƒ»åˆ¥ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ç§»ã‚‹ã¨ãã«ã‚‚ãã‚Œã»ã©å›°ã‚‰ãªã„ã€‚

### 3. é«˜é€Ÿæ€§ã¨æ‹¡å¼µæ€§

Next.jsã€‚å€‹äººã‚µã‚¤ãƒˆã«ã¯è‹¥å¹²éå‰°ã®æ„Ÿã‚‚ã‚ã‚‹ã‚‚ã®ã®ã€ãƒšãƒ¼ã‚¸é·ç§»ã®æ°—æŒã¡ã‚ˆã•ã¨ç”»åƒã®æœ€é©åŒ–ãŒé­…åŠ›çš„ã€‚ã‚ã¨å°‘ã€…è¤‡é›‘ãªã“ã¨ã‚’ã—ã‚ˆã†ã¨ã—ã¦ã‚‚ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å®ˆå‚™ç¯„å›²ã‚’å‡ºãªã„ã®ã¯è‰¯ã„ã€‚

### 4. åºƒå‘Šã‚„çµ±è¨ˆã®æ’é™¤

éå‰°ãªåºƒå‘Šãƒ»çµ±è¨ˆã«å¯¾ã—ã¦æ†æ‚ªã‚’æŠ±ã„ã¦ã„ã‚‹ãŸã‚ã€ã“ã®ã‚µã‚¤ãƒˆã«ã¯è¨­ç½®ã—ã¦ã„ãªã„ã€‚å”¯ä¸€ã€ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å…ˆã§ã‚ã‚‹VercelãŒè¡Œã£ã¦ã„ã‚‹ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã ã‘ã¯ç¢ºèªã—ã¦ã„ã‚‹ã€‚[ã“ã¡ã‚‰ã®è¨˜äº‹](/blog/posts/nextdns-install)ã‚‚å‚ç…§ã€‚

## æ©Ÿèƒ½ä¸€è¦§ã¨å®Ÿè£…

ä»¥ä¸‹ã¯ã“ã®ãƒ–ãƒ­ã‚°ã®æ©Ÿèƒ½ã¨å®Ÿè£…ã®å±•è¦§ä¼š

### Markdownã®å‡¦ç†

ï¼ˆ2022/12/28 æ›´æ–°ï¼‰

[next-mdx-remote](https://github.com/hashicorp/next-mdx-remote)ã§å‡¦ç†ã—ã¦ã„ã‚‹ã€‚

`getStaticProps`ï¼ˆ`/pages`ã®å ´åˆï¼‰ãªã„ã—`fetch` / `cache`ï¼ˆ`/app`ã®å ´åˆï¼‰ã‚’é€šã˜ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—ã—ã€JSXã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦è¿”å´ã™ã‚‹ä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ã€‚ã¾ãŸå†…éƒ¨ã§ã¯remark / rehype / MDXç³»ã®APIãŒç”¨ã„ã‚‰ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚‰ã®ç³»åˆ—ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒåˆ©ç”¨ã§ãã‚‹ã€‚

### è¨˜äº‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å–å¾—

- [remark-frontmatter](https://github.com/remarkjs/remark-frontmatter)
- [vfile-matter](https://github.com/vfile/vfile-matter)

```md
---
slug: "blog-renewal"
title: "Next.jsã§ãƒ–ãƒ­ã‚°ã‚’ã¤ãã£ãŸ"
date: "20220326"
tags: ["tech", "web", "nextjs"]
---
```

### GitHub Flavored Markdown

- [remark-gfm](https://github.com/remarkjs/remark-gfm)

```md
| just a | table |
| ------ | ----- |
| 1      | 2     |
| 3      | 4     |

https://www.haxibami.net

- [x] ãƒˆã‚¥ãƒ¼ãƒ‰ã‚¥ãƒ¼
- [ ] ãƒªã‚¹ãƒˆã‚„ã€è„šæ³¨[^1]ã‚‚æ›¸ã‘ã‚‹

[^1]: è„šæ³¨ã ã‚ˆã€œ
```

| just a | table |
| ------ | ----- |
| 1      | 2     |
| 3      | 4     |

[https://www.haxibami.net](https://www.haxibami.net)

- [x] ãƒˆã‚¥ãƒ¼ãƒ‰ã‚¥ãƒ¼
- [ ] ãƒªã‚¹ãƒˆã‚„ã€è„šæ³¨[^1]ã‚‚æ›¸ã‘ã‚‹

[^1]: è„šæ³¨ã ã‚ˆã€œ

### çµµæ–‡å­—

- [remark-gemoji](https://github.com/remarkjs/remark-gemoji)

`:v:`ãŒ :v: ã«ã€‚

### æ•°å¼

- [remark-math](https://github.com/remarkjs/remark-math)

é©å½“ãªã¨ã“ã‚ã§ KaTeX ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ã€‚

```md
$$
( \sum*{k=1}^{n} a_k b_k )^2 \leq ( \sum*{k=1}^{n} {a*k}^2 ) ( \sum*{k=1}^{n} {b_k}^2 )
$$
```

$$
( \sum_{k=1}^{n} a_k b_k )^2 \leq ( \sum_{k=1}^{n} {a_k}^2 ) ( \sum_{k=1}^{n} {b_k}^2 )
$$

```md
$e^{i\pi} + 1 = 0$ :arrow_left: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ•°å¼
```

$e^{i\pi} + 1 = 0$ :arrow\_left: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ•°å¼

### ãƒ«ãƒ“

- [remark-denden-ruby](https://github.com/fabon-f/remark-denden-ruby)

```md
> æ˜¨æ—¥åˆå¾Œã€\{â€ è–å‰£â€ |ã‚¨ã‚¯ã‚¹ã‚«ãƒªãƒãƒ¼\}ã‚’æŒ¯ã‚Šå›ã™\{å…¨è£¸ä¸­å¹´ç”·æ€§|ç„¡æ•µã®äºº\}ãŒå‡ºç¾ã—â€¦â€¦
```

> æ˜¨æ—¥åˆå¾Œã€\{â€ è–å‰£â€ |ã‚¨ã‚¯ã‚¹ã‚«ãƒªãƒãƒ¼}ã‚’æŒ¯ã‚Šå›ã™\{å…¨è£¸ä¸­å¹´ç”·æ€§|ç„¡æ•µã®äºº}ãŒå‡ºç¾ã—â€¦â€¦

### ãƒšãƒ¼ã‚¸å†…ã®è¦‹å‡ºã—ã®ãƒªãƒ³ã‚¯

- [rehype-slug](https://github.com/rehypejs/rehype-slug)
- [rehype-autolink-headings](https://github.com/rehypejs/rehype-autolink-headings)

```md
:arrow_right: [ã¯ã˜ã‚ã«](#ã¯ã˜ã‚ã«)ã«é£›ã¹ã‚‹ã‚ˆ
```

:arrow\_right: [ã¯ã˜ã‚ã«](#ã¯ã˜ã‚ã«)ã«é£›ã¹ã‚‹ã‚ˆ

### Mermaid Diagram

ï¼ˆ2023/05/07 æ›´æ–°ï¼‰

[rehype-mermaidjs](https://github.com/remcohaszing/rehype-mermaidjs)ã‚’ä½¿ã£ãŸã€‚é€šå¸¸ã®Mermaidã®ä½¿ã„æ–¹ã§ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§JSã‚’å®Ÿè¡Œã›ã–ã‚‹ã‚’å¾—ãªã„ãŒã€ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†ã¨ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹Chromiumã§[^2] ã‚ã‚‰ã‹ã˜ã‚SVGãŒæç”»ã•ã‚Œã€é™çš„ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹ã€‚

[^2]: ã“ã‚“ãªã“ã¨ã®ãŸã‚ã«ã‚ã–ã‚ã–ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ã†ã®ã‚‚ã‚¢ãƒ¬ã ãŒã€Mermaidã¯Node.jsä¸Šã§å‹•ãDOMãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ[JSDOM](https://github.com/jsdom/jsdom)ã‚„[happy-dom](https://github.com/capricorn86/happy-dom)ç­‰ï¼‰ã«ã¯å¯¾å¿œã—ã¦ã„ãªã„[ã‚ˆã†ãªã®ã§](https://github.com/mermaid-js/mermaid/issues/559)ã€ã‚„ã‚€ã‚’å¾—ãšã“ã†ãªã£ã¦ã„ã‚‹ã€‚

````md
```mermaid
sequenceDiagram
Alice->>John: Hello John, how are you?
loop Healthcheck
    John->>John: Fight against hypochondria
end
Note right of John: Rational thoughts!
John-->>Alice: Great!
John->>Bob: How about you?
Bob-->>John: Jolly good!
```

```mermaid
stateDiagram-v2
    state fork_state <<fork>>
      [*] --> fork_state
      fork_state --> State2
      fork_state --> State3

      state join_state <<join>>
      State2 --> join_state
      State3 --> join_state
      join_state --> State4
      State4 --> [*]
```

```mermaid
pie
"Dogs" : 386
"Cats" : 85
"Rats" : 15
```
````

```mermaid
sequenceDiagram
Alice->>John: Hello John, how are you?
loop Healthcheck
    John->>John: Fight against hypochondria
end
Note right of John: Rational thoughts!
John-->>Alice: Great!
John->>Bob: How about you?
Bob-->>John: Jolly good!
```

```mermaid
stateDiagram-v2
    state fork_state <<fork>>
      [*] --> fork_state
      fork_state --> State2
      fork_state --> State3

      state join_state <<join>>
      State2 --> join_state
      State3 --> join_state
      join_state --> State4
      State4 --> [*]
```

```mermaid
pie
"Dogs" : 386
"Cats" : 85
"Rats" : 15
```

### ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ

[rehype-pretty-code](https://github.com/atomiks/rehype-pretty-code)ã‚’åˆ©ç”¨ã—ãŸã€‚ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯å†…éƒ¨ã§[shiki](https://shiki.matsu.io)ã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šã€ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨ãŒãƒ“ãƒ«ãƒ‰æ™‚ã«è¡Œã‚ã‚Œã‚‹ï¼ˆ= **è¿½åŠ CSSä¸è¦**ï¼‰ã€**VSCodeã®ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ ãŒä½¿ãˆã‚‹**ã€ãªã©ã®åˆ©ç‚¹ãŒã‚ã‚‹ã€‚

### ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰

ã“ã†ã„ã† :arrow\_down: ã‚«ãƒ¼ãƒ‰ã€‚

[https://zenn.dev/tomi/articles/2021-03-22-blog-card](https://zenn.dev/tomi/articles/2021-03-22-blog-card)

[https://zenn.dev/januswel/articles/745787422d425b01e0c1](https://zenn.dev/januswel/articles/745787422d425b01e0c1)

ä¸Šã®è¨˜äº‹ã‚’å‚è€ƒã«ã€unifiedã®Transformerãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è‡ªä½œã—ã¦[å®Ÿè£…ã—ãŸ](https://github.com/haxibami/haxibami.net/blob/2db87a4118c63b211ec10f6f7e0ec3b093513468/haxibami.net/src/lib/remark-link-card.ts)ã€‚ãŠãŠã‚€ã­ã€

1. æ–‡æ›¸ä¸­ã«å˜ç‹¬ã§è²¼ã‚‰ã‚ŒãŸãƒªãƒ³ã‚¯ã®`Node`ã‚’æ¤œå‡º
2. ãƒªãƒ³ã‚¯å…ˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆ`title`ã€`description`ã€`og image`ï¼‰ã‚’å–å¾—
3. ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’`Node`ã®å±æ€§ã«ä»˜åŠ ã—ã€ç‹¬è‡ªè¦ç´ ï¼ˆä¾‹ï¼š`<linkcard>`ï¼‰ã«ç½®ãæ›ãˆ
4. ç‹¬è‡ªè¦ç´ ã‚’ã€MDXã®å‡¦ç†ç³»ï¼ˆ`next-mdx-remote`ï¼‰å´ã§è‡ªä½œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ç½®æ›

ã™ã‚‹å‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚4. ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã‚‹ã€‚

```tsx title="src/components/MDXComponent/index.tsx" /props/
import LinkCard from "components/LinkCard";
import NextImage from "components/NextImage";
import NextLink from "components/NextLink";

import type { LinkCardProps } from "components/LinkCard";
import type { NextImageProps } from "components/NextImage";
import type { NextLinkProps } from "components/NextLink";
import type { MDXComponents } from "mdx/types";

type ProvidedComponents = MDXComponents & {
  a: typeof NextLink;
  img: typeof NextImage;
  linkcard: typeof LinkCard;
};

const replaceComponents = {
  a: (props: NextLinkProps) => <NextLink {...props} />,
  img: (props: NextImageProps) => <NextImage {...props} />,
  linkcard: (props: LinkCardProps) => <LinkCard {...props} />,
} as ProvidedComponents;

export default replaceComponents;
```

```ts title="src/lib/compiler.ts"
import MDXComponent from "components/MDXComponent";

const result = compileMDX({
  source,
  components: MDXComponent,
});
```

### ç”»åƒå‡¦ç†

Markdownå†…ã®ç”»åƒã‚’[next/image](https://nextjs.org/docs/pages/api-reference/components/image)ã«ç½®ãæ›ãˆã‚‹remarkãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ã„ãŸã€‚ç½®æ›ã«åŠ ãˆã€ç”»åƒã®ã‚µã‚¤ã‚ºå–å¾—ãƒ»ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”Ÿæˆï¼ˆå‚è€ƒï¼š[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nextjs.org/docs/api-reference/next/image#placeholder)ï¼‰ã‚‚è¡Œã£ã¦ã„ã‚‹ã€‚

```ts title="src/lib/remark-image-opt.ts"
import { getPlaiceholder } from "plaiceholder";
import { visit } from "unist-util-visit";

import type { Image } from "mdast";
import type { Plugin, Transformer } from "unified";
import type { Node } from "unist";

const rehypeImageOpt: Plugin<[void]> = function imageOpt(): Transformer {
  return async (tree: Node) => {
    const promises: (() => Promise<void>)[] = [];
    visit(tree, "image", (node: Image) => {
      const src = node.url;

      promises.push(async () => {
        const blur = await getPlaiceholder(src);
        node.data = {
          hProperties: {
            src: blur.img.src,
            width: blur.img.width,
            height: blur.img.height,
            aspectRatio: `${blur.img.width} / ${blur.img.height}`,
            blurDataURL: blur.base64,
          },
        };
      });
    });
    await Promise.allSettled(promises.map((t) => t()));
  };
};

export default rehypeImageOpt;
```

### ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰

[å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://github.com/pacocoursey/next-themes)ã‚’ä½¿ç”¨ã€‚

### Open Graphç”»åƒã®ç”Ÿæˆ

ï¼ˆ2022/05/07 æ›´æ–°ï¼‰

[åˆ¥è¨˜äº‹](/blog/posts/blog-next-13#route-handler%E3%81%AB%E3%82%88%E3%82%8Bopen-graphog%E7%94%BB%E5%83%8F%E7%94%9F%E6%88%90)ã‚’å‚ç…§ã€‚

### ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ç”Ÿæˆ

ï¼ˆ2023/05/07 æ›´æ–°ï¼‰

[åˆ¥è¨˜äº‹](/blog/posts/blog-next-13#metadata-api)ã‚’å‚ç…§ã€‚

### ãƒ•ã‚£ãƒ¼ãƒ‰å¯¾å¿œ

[Feed](https://github.com/jpmonette/feed)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦å½¢å¼ã‚’æ•´ãˆã€ä¸Šã¨åŒã˜è¦é ˜ã§ãƒ“ãƒ«ãƒ‰æ™‚ã« RSSã€Atomã€JSON Feedç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åã‹ã›ã¦ã„ã‚‹ã€‚

```ts title="hooks/scripts/feed.mts"
import fs from "fs";

import { Feed } from "feed";

import { dateConverter } from "./lib/build.js";
import { SITEDATA } from "./lib/constant.js";
import { getPostsData } from "./lib/fs.js";

// variables
const HOST = "https://www.haxibami.net";

// generate feed
const feedGenerator = async () => {
  const author = {
    name: "haxibami",
    email: "contact@haxibami.net",
    link: HOST,
  };

  const date = new Date();
  const feed = new Feed({
    title: SITEDATA.blog.title,
    description: SITEDATA.blog.description,
    id: HOST,
    link: HOST,
    language: "ja",
    image: `${HOST}/kripcat.jpg`,
    favicon: `${HOST}/favicon.ico`,
    copyright: `All rights reserved ${date.getFullYear()}, ${author.name}`,
    updated: date,
    feedLinks: {
      rss2: `${HOST}/rss/feed.xml`,
      json: `${HOST}/rss/feed.json`,
      atom: `${HOST}/rss/atom.xml`,
    },
    author: author,
  });

  const blogs = await getPostsData("articles/blog");

  blogs.forEach((post) => {
    const url = `${HOST}/blog/posts/${post.data?.slug}`;
    feed.addItem({
      title: `${post.data?.title}`,
      description: `${post.preview}`,
      id: url,
      link: url,
      guid: url,
      date: new Date(dateConverter(post.data?.date)),
      category: post.data?.tags
        ? post.data?.tags.map((tag) => ({
            name: tag,
          }))
        : [],
      enclosure: {
        url: encodeURI(
          `${HOST}/api/ogp?title=${post.data?.title}&date=${post.data?.date}.png`,
        ),
        length: 0,
        type: "image/png",
      },
    });
  });

  fs.mkdirSync("public/rss", { recursive: true });
  await Promise.all([
    fs.promises.writeFile(
      "public/rss/feed.xml",
      feed.rss2().replace(/&/g, "&amp;"),
    ),
    fs.promises.writeFile("public/rss/atom.xml", feed.atom1()),
    fs.promises.writeFile("public/rss/feed.json", feed.json1()),
  ]);
};

const GenFeed = () => {
  return new Promise<void>((resolve) => {
    feedGenerator();
    resolve();
  });
};

export default GenFeed;
```

## æ„Ÿæƒ³

æœ€é«˜ï¼ã€€ã¯ã¦ãªãƒ–ãƒ­ã‚°ã‚„Qiitaã€Zennã‚ãŸã‚Šã¨å¼µã‚Šåˆãˆã‚‹æ›¸ãå¿ƒåœ°ã‹ã‚‚ã—ã‚Œãªã„ã€‚
